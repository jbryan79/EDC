<!DOCTYPE html>
<html lang="en" class="theme-darkpro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Portable Workstation</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tailwind config (optional extension) -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['system-ui', 'ui-sans-serif', 'Segoe UI', 'sans-serif']
          }
        }
      }
    };
  </script>

  <!-- Theme + component styling -->
  <style>
    :root {
      /* default (dark pro) â€“ will be overridden by theme classes */
      --bg: #020617;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --card-bg: #020617;
      --border: #1f2937;
      --accent: #38bdf8;
      --accent-2: #6366f1;
      --btn-text: #0b1120;
      --chat-bg: #020617;
      --chat-text: #e5e7eb;
      --chat-border: #1f2937;
      --chat-user-bg: #38bdf8;
      --chat-user-text: #020617;
      --chat-bot-bg: #020617;
      --chat-bot-text: #e5e7eb;
    }

    /* APPLE CLEAN */
    .theme-apple {
      --bg: #f5f5f7;
      --text: #111827;
      --muted: #6b7280;
      --card-bg: #ffffff;
      --border: #e5e7eb;
      --accent: #2563eb;
      --accent-2: #38bdf8;
      --btn-text: #ffffff;
      --chat-bg: #ffffff;
      --chat-text: #111827;
      --chat-border: #e5e7eb;
      --chat-user-bg: #2563eb;
      --chat-user-text: #ffffff;
      --chat-bot-bg: #f3f4f6;
      --chat-bot-text: #111827;
    }

    /* NEON CYBER TECH */
    .theme-neon {
      --bg: #020617;
      --text: #e0faff;
      --muted: #67e8f9;
      --card-bg: #020617;
      --border: #0f172a;
      --accent: #22d3ee;
      --accent-2: #f472b6;
      --btn-text: #020617;
      --chat-bg: #020617;
      --chat-text: #e0faff;
      --chat-border: #0f172a;
      --chat-user-bg: #f472b6;
      --chat-user-text: #020617;
      --chat-bot-bg: #020617;
      --chat-bot-text: #e0faff;
    }

    /* DARK PRO STUDIO */
    .theme-darkpro {
      --bg: #020617;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --card-bg: #020617;
      --border: #111827;
      --accent: #38bdf8;
      --accent-2: #22c55e;
      --btn-text: #020617;
      --chat-bg: #020617;
      --chat-text: #e5e7eb;
      --chat-border: #111827;
      --chat-user-bg: #38bdf8;
      --chat-user-text: #020617;
      --chat-bot-bg: #020617;
      --chat-bot-text: #e5e7eb;
    }

    /* AMAZON-AFFILIATE CLEAN */
    .theme-amazon {
      --bg: #f3f4f6;
      --text: #111827;
      --muted: #6b7280;
      --card-bg: #ffffff;
      --border: #e5e7eb;
      --accent: #2563eb;
      --accent-2: #f59e0b;
      --btn-text: #ffffff;
      --chat-bg: #ffffff;
      --chat-text: #111827;
      --chat-border: #e5e7eb;
      --chat-user-bg: #2563eb;
      --chat-user-text: #ffffff;
      --chat-bot-bg: #f9fafb;
      --chat-bot-text: #111827;
    }

    /* ULTRA MODERN GRADIENT */
    .theme-gradient {
      --bg: #020617;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --card-bg: rgba(15, 23, 42, 0.85);
      --border: rgba(148, 163, 184, 0.4);
      --accent: #6366f1;
      --accent-2: #ec4899;
      --btn-text: #0b1120;
      --chat-bg: rgba(15, 23, 42, 0.95);
      --chat-text: #e5e7eb;
      --chat-border: rgba(148, 163, 184, 0.4);
      --chat-user-bg: #6366f1;
      --chat-user-text: #0b1120;
      --chat-bot-bg: rgba(15, 23, 42, 0.95);
      --chat-bot-text: #e5e7eb;
    }

    /* Layout using CSS vars */
    body {
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .page-shell {
      max-width: 1120px;
      margin: 0 auto;
      padding: 1.5rem 1rem 4rem;
    }

    .theme-select {
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 0.75rem;
      padding: 0.5rem 0.75rem;
    }

    .card {
      background: var(--card-bg);
      border-radius: 0.75rem; /* slightly rounded */
      border: 1px solid var(--border);
    }

    .btn-primary {
      background: var(--accent);
      color: var(--btn-text);
      border-radius: 0.75rem;
    }

    .btn-primary:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    .gradient-title {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      color: transparent;
    }

    .hero-sub {
      color: var(--muted);
    }

    /* Chat widget styling */
    .chat-window {
      background: var(--chat-bg);
      color: var(--chat-text);
      border: 1px solid var(--chat-border);
      border-radius: 0.75rem;
    }

    .chat-bubble-user {
      background: var(--chat-user-bg);
      color: var(--chat-user-text);
      border-radius: 0.75rem;
    }

    .chat-bubble-bot {
      background: var(--chat-bot-bg);
      color: var(--chat-bot-text);
      border-radius: 0.75rem;
    }

    .chat-toggle {
      background: var(--chat-user-bg);
      color: var(--chat-user-text);
      border-radius: 999px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
    }

    /* Gradient theme background accents */
    html.theme-gradient body {
      background:
        radial-gradient(circle at top left, rgba(147, 51, 234, 0.35), transparent 55%),
        radial-gradient(circle at bottom right, rgba(14, 165, 233, 0.4), transparent 55%),
        #020617;
    }
  </style>
</head>

<body class="min-h-screen">
  <div class="page-shell">
    <!-- HEADER -->
    <header class="flex items-center justify-between mb-10">
      <div class="flex items-center gap-2">
        <span class="h-8 w-8 rounded-lg flex items-center justify-center bg-[var(--accent)] text-[var(--btn-text)] font-bold text-lg shadow-md">
          PW
        </span>
        <h1 class="text-2xl font-semibold tracking-tight">Portable Workstation</h1>
      </div>

      <div class="flex items-center gap-3">
        <label for="themeSelector" class="text-sm hero-sub hidden sm:inline">
          Theme
        </label>
        <select id="themeSelector" class="theme-select text-sm">
          <option value="theme-darkpro">Dark Pro</option>
          <option value="theme-neon">Neon Cyber</option>
          <option value="theme-apple">Apple Clean</option>
          <option value="theme-amazon">Affiliate Clean</option>
          <option value="theme-gradient">Ultra Gradient</option>
        </select>
      </div>
    </header>

    <!-- HERO -->
    <section class="text-center sm:text-left mb-12 sm:mb-16">
      <div class="max-w-3xl">
        <h2 class="gradient-title text-4xl sm:text-5xl md:text-6xl font-extrabold leading-tight mb-4">
          Build Your Perfect Portable Rig
        </h2>
        <p class="hero-sub text-base sm:text-lg">
          AI-powered advice. Tailored product picks. No nonsense â€” just gear that actually works on the go.
        </p>
      </div>
    </section>

    <!-- PRODUCT GRID -->
    <section>
      <h3 class="text-lg font-semibold mb-4">Starter Picks</h3>
      <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- JS injects product cards -->
      </div>
    </section>
  </div>

  <!-- CHAT TOGGLE -->
  <button id="aiChatToggle"
    class="fixed bottom-5 right-5 chat-toggle h-14 w-14 flex items-center justify-center text-2xl transition-transform hover:scale-105">
    ðŸ’¬
  </button>

  <!-- CHAT WINDOW -->
  <div id="aiChatWindow"
    class="chat-window fixed bottom-24 right-5 w-80 max-w-[90vw] shadow-2xl p-4 hidden">
    <div class="flex items-center justify-between mb-2">
      <span class="font-semibold text-sm">AI Shopping Assistant</span>
      <button id="aiChatClose" class="text-xs hero-sub hover:underline">Close</button>
    </div>

    <div id="aiChatMessages"
      class="h-64 overflow-y-auto p-2 mb-3 text-sm space-y-3 border border-[var(--chat-border)] rounded-lg">
    </div>

    <div class="flex">
      <input id="aiChatInput"
        class="flex-1 px-2 py-2 text-sm border border-[var(--chat-border)] rounded-l-lg bg-transparent outline-none"
        placeholder="Ask what to buy next..." />
      <button id="aiChatSend"
        class="btn-primary px-3 text-sm font-medium rounded-l-none">
        Send
      </button>
    </div>
  </div>

  <!-- MAIN SCRIPT -->
  <script>
    // THEME LOGIC
    const themeSelector = document.getElementById("themeSelector");
    const rootHtml = document.documentElement;

    // Set initial selector based on current class
    const currentThemeClass = rootHtml.className || "theme-darkpro";
    themeSelector.value = currentThemeClass;

    themeSelector.addEventListener("change", (e) => {
      rootHtml.className = e.target.value;
    });

    // PRODUCT DATA
    const products = [
      {
        name: "Your Laptop",
        price: "$999",
        tag: "Ultra-portable daily driver",
        img: "https://via.placeholder.com/600x400?text=Your+Laptop",
        link: "#"
      },
      {
        name: "Portable 15\" USB-C Monitor",
        price: "$189",
        tag: "Slim second screen for coffee shop work",
        img: "https://via.placeholder.com/600x400?text=Portable+Monitor",
        link: "#"
      },
      {
        name: "Compact Mechanical Keyboard",
        price: "$129",
        tag: "65% layout, travel-friendly, real keys",
        img: "https://via.placeholder.com/600x400?text=Compact+Keyboard",
        link: "#"
      },
      {
        name: "USB-C GaN Charger (100W)",
        price: "$79",
        tag: "One brick to power your whole rig",
        img: "https://via.placeholder.com/600x400?text=GaN+Charger",
        link: "#"
      },
      {
        name: "Travel Dock / Hub",
        price: "$59",
        tag: "HDMI, USB, Ethernet â€” all from one port",
        img: "https://via.placeholder.com/600x400?text=USB-C+Hub",
        link: "#"
      },
      {
        name: "Slim Laptop Stand",
        price: "$49",
        tag: "Raise the screen, save your neck",
        img: "https://via.placeholder.com/600x400?text=Laptop+Stand",
        link: "#"
      }
    ];

    const productGrid = document.getElementById("productGrid");

    function loadProducts() {
      productGrid.innerHTML = products.map(p => `
        <article class="card p-4 flex flex-col gap-3 shadow-lg hover:shadow-xl transition-shadow">
          <div class="overflow-hidden rounded-lg bg-black/10">
            <img src="${p.img}" alt="${p.name}" class="w-full h-40 object-cover" />
          </div>
          <div>
            <h4 class="text-base font-semibold mb-1">${p.name}</h4>
            <p class="text-sm hero-sub mb-1">${p.tag}</p>
            <p class="text-sm font-medium">${p.price}</p>
          </div>
          <div class="mt-auto">
            <a href="${p.link}" target="_blank"
               class="inline-flex items-center justify-center px-3 py-2 text-sm font-medium btn-primary">
              View
            </a>
          </div>
        </article>
      `).join("");
    }

    loadProducts();

    // CHAT LOGIC
    const chatWindow = document.getElementById("aiChatWindow");
    const chatToggle = document.getElementById("aiChatToggle");
    const chatClose = document.getElementById("aiChatClose");
    const chatSend = document.getElementById("aiChatSend");
    const chatInput = document.getElementById("aiChatInput");
    const chatMessages = document.getElementById("aiChatMessages");

    function toggleChat(open) {
      if (open === true) {
        chatWindow.classList.remove("hidden");
      } else if (open === false) {
        chatWindow.classList.add("hidden");
      } else {
        chatWindow.classList.toggle("hidden");
      }
    }

    chatToggle.addEventListener("click", () => toggleChat());
    chatClose.addEventListener("click", () => toggleChat(false));

    chatSend.addEventListener("click", handleSend);
    chatInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    });

    function addMessage(sender, text) {
      const wrapper = document.createElement("div");
      wrapper.className = sender === "user" ? "text-right" : "text-left";

      wrapper.innerHTML = `
        <span class="inline-block px-3 py-2 text-xs sm:text-sm max-w-[90%] ${sender === "user" ? "chat-bubble-user" : "chat-bubble-bot"}">
          ${text}
        </span>
      `;
      chatMessages.appendChild(wrapper);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function handleSend() {
      const prompt = chatInput.value.trim();
      if (!prompt) return;

      addMessage("user", prompt);
      chatInput.value = "";
      try {
        const reply = await askAI(prompt);
        addMessage("bot", reply);
      } catch (err) {
        addMessage("bot", "Something went wrong on my side. Try again in a moment.");
      }
    }

    async function askAI(prompt) {
      const res = await fetch("/api/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt })
      });

      const data = await res.json();
      return data.reply || "I couldn't come up with a suggestion. Try asking in a different way.";
    }
  </script>
</body>
</html>
